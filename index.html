<!DOCTYPE html>
<html ng-app="demoapp">
  <head>
    <script src="bower_components/angular/angular.min.js"></script>
    <script src="bower_components/leaflet/dist/leaflet.js"></script>
    <script src="angular-leaflet-directive/dist/angular-leaflet-directive.min.js"></script>
    <link rel="stylesheet" href="bower_components/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="bower_components/flatstrap-sass/vendor/assets/stylesheets/flatstrap.css">
    <link rel="stylesheet" href="bower_components/flatstrap-sass/templates/project/styles.css">
    <link rel="stylesheet" type="text/css" href="http://cloud.github.com/downloads/lafeber/world-flags-sprite/flags32.css" />
   
    <script>
        var app = angular.module("demoapp", ["leaflet-directive"]);
        app.controller('DemoController', [ "$scope", "$http", function($scope, $http) {

            $scope.$on("leafletDirectiveMap.geojsonMouseover", function(ev, leafletEvent) {
                countryMouseover(leafletEvent);
            });

            $scope.$on("leafletDirectiveMap.geojsonClick", function(ev, featureSelected, leafletEvent) {
                countryClick(featureSelected, leafletEvent);
            });

            var continentProperties= {
                    "009": {
                            name: 'Oceania',
                            colors: [ '#CC0066', '#993366', '#990066', '#CC3399', '#CC6699' ]
                    },
                    "019": {
                            name: 'America',
                            colors: [ '#006699', '#336666', '#003366', '#3399CC', '#6699CC' ]
                    },
                    "150": {
                            name: 'Europe',
                            colors: [ '#FF0000', '#CC3333', '#990000', '#FF3333', '#FF6666' ]
                    },
                    "002": {
                            name: 'Africa',
                            colors: [ '#00CC00', '#339933', '#009900', '#33FF33', '#66FF66' ]
                    },
                    "142": {
                            name: 'Asia',
                            colors: [ '#FFCC00', '#CC9933', '#999900', '#FFCC33', '#FFCC66' ]
                    },
            };

            angular.extend($scope, {
                center: {
                    lat: 56.7015,
                    lng: -3.5211,
                    zoom: 5
                },
                legend: {
                    colors: [ '#CC0066', '#006699', '#FF0000', '#00CC00', '#FFCC00' ],
                    labels: [ 'Oceania', 'America', 'Europe', 'Africa', 'Asia' ]
                }
            });

            function countryClick(country, event) {
                console.log(country.properties.name);
            }

            // Get a country paint color from the continents array of colors
            function getColor(country) {
                if (!country || !country["region-code"]) {
                    return "#FFF";
                }

                var colors = continentProperties[country["region-code"]].colors;
                var index = country["alpha-3"].charCodeAt(0) % colors.length ;
                return colors[index];
            }

            function style(feature) {
                return {
                    fillColor: getColor($scope.countries[feature.id]),
                    weight: 2,
                    opacity: 1,
                    color: 'white',
                    dashArray: '3',
                    fillOpacity: 0.7
                };
            }

            // Mouse over function, called from the Leaflet Map Events
            function countryMouseover(leafletEvent) {
                var layer = leafletEvent.target;
                layer.setStyle({
                    weight: 2,
                    color: '#666',
                    fillColor: 'white'
                });
                layer.bringToFront();
            }

            // Get the countries data from a JSON
            $http.get("angular-leaflet-directive/examples/json/all.json").success(function(data, status) {

                // Put the countries on an associative array
                // $scope.countries = {};
                // for (var i=0; i< data.length; i++) {
                //     var country = data[i];
                //     $scope.countries[country['alpha-3']] = country;
                // }

                // Get the countries geojson data from a JSON
                $http.get("angular-leaflet-directive/examples/json/countries.geo.json").success(function(data, status) {
                    angular.extend($scope, {
                        geojson: {
                            data: data,
                            style: style,
                            resetStyleOnMouseout: true
                        }
                    });
                });
            });
        }]);
    </script>
    
  </head>
  <body ng-controller="DemoController">
<div class="container">

<div class="row">
  <header class="span12">
      <h1 class="brand"> <span class="topline">V<span class="num-3">3</span>lo<span class="hyphen">-</span></span><br /><span class="bottom-line">scape</span></h1>
      <h2 class="strap">Sculpt the future of cycling in your area.</h2>
  </header>
  </div> <!-- /row-fluid -->
  <div class="clearfix"></div>
  </div><!--  /container -->
<style>
 .angular-leaflet-map {
            height: 80%;
        }
</style>

    <div class="info country f32">
        <div ng-show="geojson.selected" class="flag" ng-class="countries[geojson.selected.id]['alpha-2']|lowercase"></div>
        {{ geojson.selected.properties.name || 'No country'}}
    </div>
    <div class="info box">Map center: [ lat: {{ center.lat | number:4 }}, lng: {{ center.lng | number:4 }} ]</div>
    <leaflet center="center" events="events" legend="legend" geojson="geojson"></leaflet>
    
    <div class="container">
        <div class="row">
            <div class="post-cd offset8 span4">
                <form action="post" class="code">
                <h3>Enter your postcode.</h3>
                    <input class="input-medium search-query" name="postcode" placeholder="Enter Your Postcode" type="text">
                    <button class="btn btn-primary">Search</button>
                </form>
            </div>
        </div>
    </div>
    <script src="bower_components/flatstrap-sass/vendor/assets/javascripts/bootstrap.js"></script>	
 <script src="http://code.jquery.com/jquery-latest.js"></script>
 <link href='http://fonts.googleapis.com/css?family=Raleway:400,800,200' rel='stylesheet' type='text/css'>
  </body>
</html>